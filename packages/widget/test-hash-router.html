<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hash Router Test</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .test-section {
      margin: 20px 0;
      padding: 20px;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
    }
    .hash-display {
      background: #f3f4f6;
      padding: 10px;
      border-radius: 4px;
      font-family: monospace;
      margin: 10px 0;
    }
    button {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background: #2563eb;
    }
    h2 {
      margin-top: 0;
    }
    .navigation {
      background: #fef3c7;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .navigation a {
      margin-right: 20px;
      color: #92400e;
    }
  </style>
</head>
<body>
  <h1>Non-Destructive Hash Router Test</h1>
  
  <!-- Test user navigation -->
  <div class="navigation">
    <strong>User's navigation (should be preserved):</strong>
    <a href="#section-1">Section 1</a>
    <a href="#section-2">Section 2</a>
    <a href="#my-app/route">My App Route</a>
    <a href="#complex/user/hash/123">Complex Hash</a>
  </div>

  <div class="test-section">
    <h2>Current Hash</h2>
    <div id="hash-display" class="hash-display"></div>
    <small>User Part: <span id="user-part"></span></small><br>
    <small>Widget Part: <span id="widget-part"></span></small>
  </div>

  <div class="test-section">
    <h2>Widget Controls</h2>
    <button onclick="openProduct('cool-tshirt')">Open Product: cool-tshirt</button>
    <button onclick="openProduct('awesome-hoodie')">Open Product: awesome-hoodie</button>
    <button onclick="goToList()">Back to List</button>
    <button onclick="openCart()">Open Cart</button>
    <button onclick="closeCart()">Close Cart</button>
    <button onclick="setPage(2)">Go to Page 2</button>
    <button onclick="setPage(3)">Go to Page 3</button>
  </div>

  <!-- Shoprocket Widget -->
  <div class="test-section">
    <h2>Widget Embed (First catalog is primary)</h2>
    <div data-shoprocket="catalog" 
         data-limit="6"
         data-routable="true">
    </div>
  </div>

  <div class="test-section">
    <h2>Second Widget (should not affect URL)</h2>
    <div data-shoprocket="catalog" 
         data-limit="3">
    </div>
  </div>

  <!-- Test sections for anchors -->
  <div id="section-1" class="test-section" style="margin-top: 100px;">
    <h2>Section 1</h2>
    <p>This section should be reachable via #section-1 even when widget state is active</p>
  </div>

  <div id="section-2" class="test-section">
    <h2>Section 2</h2>
    <p>This section should be reachable via #section-2 even when widget state is active</p>
  </div>

  <!-- Shoprocket Script -->
  <script src="http://localhost:5173/shoprocket.js?pk=pk_test_your_key"></script>

  <script>
    // Display current hash
    function updateHashDisplay() {
      const hash = window.location.hash;
      document.getElementById('hash-display').textContent = hash || '(empty)';
      
      // Parse hash parts
      const [userPart = '', widgetPart = ''] = hash.split('#!/');
      document.getElementById('user-part').textContent = userPart || '(none)';
      document.getElementById('widget-part').textContent = widgetPart ? '#!/' + widgetPart : '(none)';
    }

    // Update display on hash change
    window.addEventListener('hashchange', updateHashDisplay);
    updateHashDisplay();

    // Test functions (would normally use the widget's API)
    function openProduct(slug) {
      // Simulate widget navigation
      const event = new CustomEvent('navigate-product', {
        detail: { product: { slug } },
        bubbles: true
      });
      document.querySelector('[data-shoprocket="catalog"]').dispatchEvent(event);
    }

    function goToList() {
      const event = new CustomEvent('back-to-list', { bubbles: true });
      document.querySelector('[data-shoprocket="catalog"]').dispatchEvent(event);
    }

    function openCart() {
      window.dispatchEvent(new CustomEvent('open-cart', { bubbles: true }));
    }

    function closeCart() {
      window.dispatchEvent(new CustomEvent('close-cart', { bubbles: true }));
    }

    function setPage(page) {
      // This would normally be done through catalog pagination
      console.log('Page navigation would update to page:', page);
    }
  </script>
</body>
</html>