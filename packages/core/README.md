# @shoprocket/core

Lightweight core SDK for Shoprocket eCommerce platform. This package provides a simple API client for interacting with Shoprocket stores.

## Installation

```bash
npm install @shoprocket/core
```

## Usage

```javascript
import { ShoprocketCore } from '@shoprocket/core';

// Initialize the SDK
const shoprocket = new ShoprocketCore({
  publicKey: 'pk_your_public_key'
});

// Get products
const products = await shoprocket.products.list();

// Add to cart
await shoprocket.cart.addItem('prod_123', 1);
```

## Bundle Size

This package is designed to be extremely lightweight:
- **< 10KB** minified
- **< 3KB** gzipped
- Zero dependencies

## API Reference

### Initialize

```javascript
const shoprocket = new ShoprocketCore({
  publicKey: 'pk_xxx',     // Required
  apiUrl: 'https://...',   // Optional custom API URL
  locale: 'en',            // Optional locale
  sessionToken: 'xxx'      // Optional session token
});
```

### Products

```javascript
// List products
const products = await shoprocket.products.list({
  page: 1,
  per_page: 12,
  sort: 'created_at'
});

// Get single product
const product = await shoprocket.products.get('prod_123');
```

### Cart

```javascript
// Get cart
const cart = await shoprocket.cart.get();

// Add item
await shoprocket.cart.addItem('prod_123', 2);

// Update quantity
await shoprocket.cart.updateItem('item_456', 3);

// Remove item
await shoprocket.cart.removeItem('item_456');
```

### Session

```javascript
// Create session
const session = await shoprocket.session.create();
shoprocket.setSessionToken(session.session_token);
```

## Development

### Building

The package uses Vite with `vite-plugin-dts` for both JavaScript bundling and TypeScript declaration generation:

```bash
npm run build
```

**Important**: The build script should ONLY run `vite build`. Do NOT add `tsc --declaration` or similar commands, as they will overwrite the properly rolled-up type declarations that `vite-plugin-dts` generates.

### Type Declarations

Type declarations are automatically generated by `vite-plugin-dts` with `rollupTypes: true`, which:
- Bundles all type declarations into a single `dist/index.d.ts` file
- Eliminates relative imports between type files
- Ensures all exports are at the top level for easy consumption

**Common Pitfall**: Adding `tsc --declaration --emitDeclarationOnly` to the build script will cause TypeScript to generate modular declarations that overwrite the rolled-up types, breaking type imports in consuming packages.

### Adding New Exports

When adding new services, types, or interfaces to the core SDK:

1. Add your code to `src/` (e.g., new service in `src/services/`)
2. Export it from `src/index.ts`:
   ```typescript
   export * from './services/your-service';
   export type { YourInterface } from './types';
   ```
3. Run `npm run build` - vite-plugin-dts will automatically include it in the rolled-up `index.d.ts`
4. Verify the export appears in `dist/index.d.ts` (should be at top level, no relative imports)
5. Consumers can then import it:
   ```typescript
   import type { YourInterface } from '@shoprocket/core';
   ```

### Testing Changes in Widget Package

After making changes to core:

```bash
# In packages/core
npm run build

# In packages/widget (separate terminal)
npm run build  # Should build without TypeScript errors
```

If you see TypeScript errors about missing exports, check that:
- The export exists in `dist/index.d.ts` at the top level
- You're using `import type` for interfaces/types (not `import`)
- The build script hasn't been modified to include `tsc` commands

## License

MIT Â© Shoprocket Ltd.